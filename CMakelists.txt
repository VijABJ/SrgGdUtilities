
cmake_minimum_required (VERSION 3.20)
project (SrgUtils)

file(GLOB SOURCES "${CMAKE_CURRENT_SOURCE_DIR}/src/*.c*" "${CMAKE_CURRENT_SOURCE_DIR}/src/*.h*")
add_library(${PROJECT_NAME} SHARED ${SOURCES} ${NATIVE_SOURCES})
TARGET_COMPILE_OPTIONS(${PROJECT_NAME} PRIVATE "/MT$<$<CONFIG:Release>:>")
TARGET_COMPILE_OPTIONS(${PROJECT_NAME} PRIVATE "/MT$<$<CONFIG:Debug>:>")

# this is for godot header files
add_compile_definitions(TYPED_METHOD_BIND NOMINMAX GUID_WINDOWS)

if(MSVC)
  target_link_libraries(${PROJECT_NAME} Ole32)
  target_link_libraries(${PROJECT_NAME} optimized libgodot-cpp.windows.template_release.x86_64)
  target_link_libraries(${PROJECT_NAME} debug libgodot-cpp.windows.template_debug.x86_64)

  set_target_properties(${PROJECT_NAME}
    PROPERTIES
    ARCHIVE_OUTPUT_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/lib"
    ARCHIVE_OUTPUT_DIRECTORY_DEBUG "${CMAKE_CURRENT_SOURCE_DIR}/lib"
    ARCHIVE_OUTPUT_DIRECTORY_RELEASE "${CMAKE_CURRENT_SOURCE_DIR}/lib"
    LIBRARY_OUTPUT_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/lib"
    LIBRARY_OUTPUT_DIRECTORY_DEBUG "${CMAKE_CURRENT_SOURCE_DIR}/lib"
    LIBRARY_OUTPUT_DIRECTORY_RELEASE "${CMAKE_CURRENT_SOURCE_DIR}/lib"
    RUNTIME_OUTPUT_DIRECTORY "${CMAKE_CURRENT_SOURCE_DIR}/lib"
    RUNTIME_OUTPUT_DIRECTORY_DEBUG "${CMAKE_CURRENT_SOURCE_DIR}/lib"
    RUNTIME_OUTPUT_DIRECTORY_RELEASE "${CMAKE_CURRENT_SOURCE_DIR}/lib"
  )
endif()

